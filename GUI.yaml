# ---------------------------------------------------
# Mihomo (Clash Meta) ç²¾ç®€ç‰ˆè¦†å†™é…ç½®
# ä¿ç•™ï¼šé¦™æ¸¯ã€æ—¥æœ¬ã€ç¾å›½ã€å…¶ä»–(å…¨çƒ)
# ---------------------------------------------------

# --- 1. åŸºç¡€è®¾ç½® ---
mode: rule
ipv6: true
log-level: info
allow-lan: true
unified-delay: true
tcp-concurrent: true
global-client-fingerprint: chrome

tun:
  enable: true
  stack: system
  auto-route: true
  auto-detect-interface: true
  dns-hijack:
    - any:53

sniffer:
  enable: true
  parse-pure-ip: true
  sniff:
    HTTP: { ports: [80, 8080-8880], override-destination: true }
    TLS: { ports: [443, 8443] }
    QUIC: { ports: [443, 8443] }
  skip-domain:
    - "Mijia Cloud"
    - "+.push.apple.com"

dns:
  enable: true
  listen: 0.0.0.0:1053
  ipv6: true
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter: ["*", "+.lan", "+.local"]
  nameserver:
    - https://223.5.5.5/dns-query
    - https://1.12.12.12/dns-query
  nameserver-policy:
    "geosite:cn,private": [https://223.5.5.5/dns-query]
    "geosite:geolocation-!cn": [https://8.8.8.8/dns-query]

# ==========================================
# âš“ é”šç‚¹ (åªä¿ç•™ æ¸¯ã€æ—¥ã€ç¾ã€å…¨)
# ==========================================
anchor-filters:
  - &FilterHK '(?i)ğŸ‡­ğŸ‡°|é¦™æ¸¯|(\b(HK|HKG|Hong)(\d+)?\b)'
  - &FilterJP '(?i)ğŸ‡¯ğŸ‡µ|æ—¥æœ¬|å·æ—¥|ä¸œäº¬|å¤§é˜ª|(\b(JP|JPN|Japan)(\d+)?\b)'
  - &FilterUS '(?i)ğŸ‡ºğŸ‡¸|ç¾å›½|æ³¢ç‰¹å…°|è¾¾æ‹‰æ–¯|æ´›æ‰çŸ¶|åœ£ä½•å¡|(\b(US|USA|United States)(\d+)?\b)'
  - &FilterAll '^(?=.*(.))(?!.*((?i)ç¾¤|é‚€è¯·|è¿”åˆ©|å¾ªç¯|å®˜ç½‘|å®¢æœ|ç½‘ç«™|ç½‘å€|è·å–|è®¢é˜…|æµé‡|åˆ°æœŸ|æœºåœº|é‡ç½®|è”ç³»|é‚®ç®±|å·¥å•|è´©å–|é€šçŸ¥|å€’å–|é˜²æ­¢|å›½å†…|åœ°å€|é¢‘é“|è¯´æ˜|ä½¿ç”¨|æç¤º|ç‰¹åˆ«|è®¿é—®|æ”¯æŒ|æ•™ç¨‹|å…³æ³¨|æ›´æ–°|ä½œè€…|åŠ å…¥|è¶…æ—¶|ç¦åˆ©|å‰©ä½™|å¥—é¤)).*$'

anchor-params:
  - &AutoTest {type: url-test, interval: 300, tolerance: 50, lazy: true, url: 'http://www.gstatic.com/generate_204'}

# ==========================================
# ğŸ® ç­–ç•¥ç»„
# ==========================================
proxy-groups:
  # --- 1. ä¸»å…¥å£ ---
  - {name: ğŸš€ èŠ‚ç‚¹é€‰æ‹©, type: select, proxies: [ğŸˆ è‡ªåŠ¨é€‰æ‹©, ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹, ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹, ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹, ğŸŒ å…¨çƒèŠ‚ç‚¹, ğŸ¯ å…¨çƒç›´è¿]}
  
  # --- 2. åœºæ™¯åˆ†æµ (ç®€åŒ–ç‰ˆ) ---
  # AI ä¼˜å…ˆèµ°ç¾å›½ï¼Œå…¶æ¬¡æ—¥æœ¬
  - {name: ğŸ¤– AI æœåŠ¡, type: select, proxies: [ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹, ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹, ğŸš€ èŠ‚ç‚¹é€‰æ‹©]}
  # æµåª’ä½“ ä¼˜å…ˆèµ°èŠ‚ç‚¹é€‰æ‹©æˆ–ç‰¹å®šåœ°åŒº
  - {name: ğŸ¥ Netflix, type: select, proxies: [ğŸš€ èŠ‚ç‚¹é€‰æ‹©, ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹, ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹, ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹, ğŸŒ å…¨çƒèŠ‚ç‚¹]}
  - {name: ğŸ Apple, type: select, proxies: [ğŸ¯ å…¨çƒç›´è¿, ğŸš€ èŠ‚ç‚¹é€‰æ‹©, ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹]} 
  - {name: ğŸŸ æ¼ç½‘ä¹‹é±¼, type: select, proxies: [ğŸš€ èŠ‚ç‚¹é€‰æ‹©, ğŸ¯ å…¨çƒç›´è¿]}

  # --- 3. è‡ªåŠ¨æµ‹é€Ÿåˆ†ç»„ (æ­£åˆ™æå–) ---
  - {name: ğŸˆ è‡ªåŠ¨é€‰æ‹©, <<: *AutoTest, include-all-providers: true, filter: *FilterAll}
  - {name: ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹, <<: *AutoTest, include-all-providers: true, filter: *FilterHK}
  - {name: ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹, <<: *AutoTest, include-all-providers: true, filter: *FilterJP}
  - {name: ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹, <<: *AutoTest, include-all-providers: true, filter: *FilterUS}
  
  # --- 4. å…¶ä»–/æ‰‹åŠ¨é€‰æ‹© ---
  # è¿™é‡Œä½¿ç”¨ select ç±»å‹ï¼Œæ–¹ä¾¿ä½ æ‰‹åŠ¨å¯»æ‰¾æ–°åŠ å¡ã€éŸ©å›½ç­‰å…¶ä»–èŠ‚ç‚¹
  - {name: ğŸŒ å…¨çƒèŠ‚ç‚¹, type: select, include-all-providers: true, filter: *FilterAll}

  # --- 5. åŸºç¡€ ---
  - {name: ğŸ¯ å…¨çƒç›´è¿, type: select, proxies: [DIRECT]}
  - {name: ğŸ›‘ å…¨çƒæ‹¦æˆª, type: select, proxies: [REJECT, DIRECT]}

# ==========================================
# ğŸ“ è§„åˆ™é›†
# ==========================================
rule-providers:
  reject_ads:
    type: http
    behavior: classical
    url: "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@meta/geo/geosite/category-ads-all.yaml"
    path: ./rules/reject_ads.yaml
    interval: 86400

  ai_services:
    type: http
    behavior: classical
    url: "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@meta/geo/geosite/ai.yaml"
    path: ./rules/ai.yaml
    interval: 86400

  media_netflix:
    type: http
    behavior: classical
    url: "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@meta/geo/geosite/netflix.yaml"
    path: ./rules/netflix.yaml
    interval: 86400

  apple_services:
    type: http
    behavior: classical
    url: "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@meta/geo/geosite/apple.yaml"
    path: ./rules/apple.yaml
    interval: 86400

  china_ip:
    type: http
    behavior: ipcidr
    url: "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@meta/geo/geoip/cn.yaml"
    path: ./rules/cn_ip.yaml
    interval: 86400

  china_domain:
    type: http
    behavior: classical
    url: "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@meta/geo/geosite/cn.yaml"
    path: ./rules/cn_domain.yaml
    interval: 86400

# ==========================================
# ğŸš¦ è·¯ç”±é€»è¾‘
# ==========================================
rules:
  - RULE-SET,reject_ads,ğŸ›‘ å…¨çƒæ‹¦æˆª
  - RULE-SET,ai_services,ğŸ¤– AI æœåŠ¡
  - RULE-SET,media_netflix,ğŸ¥ Netflix
  - RULE-SET,apple_services,ğŸ Apple
  - RULE-SET,china_domain,ğŸ¯ å…¨çƒç›´è¿
  - RULE-SET,china_ip,ğŸ¯ å…¨çƒç›´è¿
  - GEOSITE,CN,ğŸ¯ å…¨çƒç›´è¿
  - GEOIP,CN,ğŸ¯ å…¨çƒç›´è¿
  - MATCH,ğŸŸ æ¼ç½‘ä¹‹é±¼
