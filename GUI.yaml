# ---------------------------------------------------
# Mihomo (Clash Meta) è¦†å†™/Merge é…ç½®
# é€‚ç”¨å®¢æˆ·ç«¯ï¼šClash Verge Rev, Mihomo Party, Clash Nyanpasu
# ---------------------------------------------------

# --- 1. åŸºç¡€è¦†å†™ (æ¥ç®¡ç³»ç»Ÿè®¾ç½®) ---
mode: rule
ipv6: true
log-level: info
allow-lan: true
unified-delay: true
tcp-concurrent: true
global-client-fingerprint: chrome

# å¼€å¯ TUN æ¨¡å¼ (å¦‚æœå®¢æˆ·ç«¯å·²æœ‰å¼€å…³ï¼Œè¿™é‡Œå¯ä½œä¸ºåŒé‡ä¿é™©)
tun:
  enable: true
  stack: system
  auto-route: true
  auto-detect-interface: true
  dns-hijack:
    - any:53

# --- 2. åŸŸåå—…æ¢ (é˜²æ­¢æµé‡è¢«é”™è¯¯åˆ†æµ) ---
sniffer:
  enable: true
  parse-pure-ip: true
  sniff:
    HTTP: { ports: [80, 8080-8880], override-destination: true }
    TLS: { ports: [443, 8443] }
    QUIC: { ports: [443, 8443] }
  skip-domain:
    - "Mijia Cloud"
    - "+.push.apple.com"

# --- 3. DNS è¦†å†™ (é˜²æ³„æ¼æœ€ä½³å®è·µ) ---
dns:
  enable: true
  listen: 0.0.0.0:1053
  ipv6: true
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter:
    - "*"
    - "+.lan"
    - "+.local"
  nameserver:
    - https://223.5.5.5/dns-query
    - https://1.12.12.12/dns-query
  nameserver-policy:
    "geosite:cn,private": [https://223.5.5.5/dns-query, https://223.6.6.6/dns-query]
    "geosite:geolocation-!cn": [https://8.8.8.8/dns-query, https://1.1.1.1/dns-query]

# ==========================================
# âš“ é”šç‚¹å®šä¹‰ (ç”¨äºæ­£åˆ™ç­›é€‰)
# ==========================================
anchor-filters:
  - &FilterHK '(?i)ğŸ‡­ğŸ‡°|é¦™æ¸¯|(\b(HK|HKG|Hong)(\d+)?\b)'
  - &FilterTW '(?i)ğŸ‡¹ğŸ‡¼|å°æ¹¾|(\b(TW|TWN|Tai|Taiwan)(\d+)?\b)'
  - &FilterJP '(?i)ğŸ‡¯ğŸ‡µ|æ—¥æœ¬|å·æ—¥|ä¸œäº¬|å¤§é˜ª|(\b(JP|JPN|Japan)(\d+)?\b)'
  - &FilterKR '(?i)ğŸ‡°ğŸ‡·|éŸ©å›½|é¦–å°”|(\b(KR|KOR|Korea)(\d+)?\b)'
  - &FilterSG '(?i)ğŸ‡¸ğŸ‡¬|æ–°åŠ å¡|ç‹®|(\b(SG|SGP|Singapore)(\d+)?\b)'
  - &FilterUS '(?i)ğŸ‡ºğŸ‡¸|ç¾å›½|æ³¢ç‰¹å…°|è¾¾æ‹‰æ–¯|æ´›æ‰çŸ¶|åœ£ä½•å¡|(\b(US|USA|United States)(\d+)?\b)'
  - &FilterAll '^(?=.*(.))(?!.*((?i)ç¾¤|é‚€è¯·|è¿”åˆ©|å¾ªç¯|å®˜ç½‘|å®¢æœ|ç½‘ç«™|ç½‘å€|è·å–|è®¢é˜…|æµé‡|åˆ°æœŸ|æœºåœº|é‡ç½®|è”ç³»|é‚®ç®±|å·¥å•|è´©å–|é€šçŸ¥|å€’å–|é˜²æ­¢|å›½å†…|åœ°å€|é¢‘é“|è¯´æ˜|ä½¿ç”¨|æç¤º|ç‰¹åˆ«|è®¿é—®|æ”¯æŒ|æ•™ç¨‹|å…³æ³¨|æ›´æ–°|ä½œè€…|åŠ å…¥|è¶…æ—¶|ç¦åˆ©|å‰©ä½™|å¥—é¤)).*$'

anchor-params:
  - &AutoTest {type: url-test, interval: 300, tolerance: 50, lazy: true, url: 'http://www.gstatic.com/generate_204'}

# ==========================================
# ğŸ® ç­–ç•¥ç»„ (è‡ªåŠ¨ä»ä½ çš„è®¢é˜…ä¸­æŠ“å–èŠ‚ç‚¹)
# å…³é”®å‚æ•°: include-all-providers: true
# ==========================================
proxy-groups:
  # --- 1. ä¸»æ§ç»„ ---
  - {name: ğŸš€ èŠ‚ç‚¹é€‰æ‹©, type: select, proxies: [ğŸˆ è‡ªåŠ¨é€‰æ‹©, ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹, ğŸ‡¹ğŸ‡¼ å°æ¹¾èŠ‚ç‚¹, ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹, ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹, ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹, ğŸ‡°ğŸ‡· éŸ©å›½èŠ‚ç‚¹, ğŸ¯ å…¨çƒç›´è¿]}
  
  # --- 2. åœºæ™¯åˆ†æµ ---
  - {name: ğŸ¤– AI æœåŠ¡, type: select, proxies: [ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹, ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹, ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹, ğŸš€ èŠ‚ç‚¹é€‰æ‹©]}
  - {name: ğŸ¥ Netflix, type: select, proxies: [ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹, ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹, ğŸ‡¹ğŸ‡¼ å°æ¹¾èŠ‚ç‚¹, ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹, ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹, ğŸš€ èŠ‚ç‚¹é€‰æ‹©]}
  - {name: ğŸ Apple, type: select, proxies: [ğŸ¯ å…¨çƒç›´è¿, ğŸš€ èŠ‚ç‚¹é€‰æ‹©, ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹]} 
  - {name: ğŸµ TikTok, type: select, proxies: [ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹, ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹, ğŸš€ èŠ‚ç‚¹é€‰æ‹©]}
  - {name: â“‚ï¸ å¾®è½¯æœåŠ¡, type: select, proxies: [ğŸ¯ å…¨çƒç›´è¿, ğŸš€ èŠ‚ç‚¹é€‰æ‹©]}
  - {name: ğŸ® æ¸¸æˆæ¨¡å¼, type: select, proxies: [ğŸ¯ å…¨çƒç›´è¿, ğŸ‡¹ğŸ‡¼ å°æ¹¾èŠ‚ç‚¹, ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹, ğŸš€ èŠ‚ç‚¹é€‰æ‹©]}
  - {name: ğŸŸ æ¼ç½‘ä¹‹é±¼, type: select, proxies: [ğŸš€ èŠ‚ç‚¹é€‰æ‹©, ğŸ¯ å…¨çƒç›´è¿]}

  # --- 3. è‡ªåŠ¨æ­£åˆ™åˆ†ç»„ (æ— éœ€æ‰‹åŠ¨æŒ‡å®šè®¢é˜…) ---
  - {name: ğŸˆ è‡ªåŠ¨é€‰æ‹©, <<: *AutoTest, include-all-providers: true, filter: *FilterAll}
  - {name: ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹, <<: *AutoTest, include-all-providers: true, filter: *FilterHK}
  - {name: ğŸ‡¹ğŸ‡¼ å°æ¹¾èŠ‚ç‚¹, <<: *AutoTest, include-all-providers: true, filter: *FilterTW}
  - {name: ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹, <<: *AutoTest, include-all-providers: true, filter: *FilterJP}
  - {name: ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹, <<: *AutoTest, include-all-providers: true, filter: *FilterSG}
  - {name: ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹, <<: *AutoTest, include-all-providers: true, filter: *FilterUS}
  - {name: ğŸ‡°ğŸ‡· éŸ©å›½èŠ‚ç‚¹, <<: *AutoTest, include-all-providers: true, filter: *FilterKR}

  # --- 4. åŸºç¡€ç»„ ---
  - {name: ğŸ¯ å…¨çƒç›´è¿, type: select, proxies: [DIRECT]}
  - {name: ğŸ›‘ å…¨çƒæ‹¦æˆª, type: select, proxies: [REJECT, DIRECT]}

# ==========================================
# ğŸ“ è§„åˆ™é›†å¼•ç”¨
# ==========================================
rule-providers:
  reject_ads:
    type: http
    behavior: classical
    url: "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@meta/geo/geosite/category-ads-all.yaml"
    path: ./rules/reject_ads.yaml
    interval: 86400

  ai_services:
    type: http
    behavior: classical
    url: "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@meta/geo/geosite/ai.yaml"
    path: ./rules/ai.yaml
    interval: 86400

  media_netflix:
    type: http
    behavior: classical
    url: "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@meta/geo/geosite/netflix.yaml"
    path: ./rules/netflix.yaml
    interval: 86400

  social_tiktok:
    type: http
    behavior: classical
    url: "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@meta/geo/geosite/tiktok.yaml"
    path: ./rules/tiktok.yaml
    interval: 86400

  apple_services:
    type: http
    behavior: classical
    url: "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@meta/geo/geosite/apple.yaml"
    path: ./rules/apple.yaml
    interval: 86400

  microsoft:
    type: http
    behavior: classical
    url: "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@meta/geo/geosite/microsoft.yaml"
    path: ./rules/microsoft.yaml
    interval: 86400

  games:
    type: http
    behavior: classical
    url: "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@meta/geo/geosite/category-games@cn.yaml"
    path: ./rules/games.yaml
    interval: 86400

  china_ip:
    type: http
    behavior: ipcidr
    url: "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@meta/geo/geoip/cn.yaml"
    path: ./rules/cn_ip.yaml
    interval: 86400

  china_domain:
    type: http
    behavior: classical
    url: "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@meta/geo/geosite/cn.yaml"
    path: ./rules/cn_domain.yaml
    interval: 86400

# ==========================================
# ğŸš¦ è·¯ç”±è§„åˆ™
# ==========================================
rules:
  - RULE-SET,reject_ads,ğŸ›‘ å…¨çƒæ‹¦æˆª
  - RULE-SET,ai_services,ğŸ¤– AI æœåŠ¡
  - RULE-SET,media_netflix,ğŸ¥ Netflix
  - RULE-SET,social_tiktok,ğŸµ TikTok
  - RULE-SET,games,ğŸ® æ¸¸æˆæ¨¡å¼
  - RULE-SET,apple_services,ğŸ Apple
  - RULE-SET,microsoft,â“‚ï¸ å¾®è½¯æœåŠ¡
  - RULE-SET,china_domain,ğŸ¯ å…¨çƒç›´è¿
  - RULE-SET,china_ip,ğŸ¯ å…¨çƒç›´è¿
  - GEOSITE,CN,ğŸ¯ å…¨çƒç›´è¿
  - GEOIP,CN,ğŸ¯ å…¨çƒç›´è¿
  - MATCH,ğŸŸ æ¼ç½‘ä¹‹é±¼
